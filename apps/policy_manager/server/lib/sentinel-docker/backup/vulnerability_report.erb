<html xml:lang="en" lang="en">
<head>
<title>Vulnerability Report</title>
<style type="text/css" media="screen">
body {
  font-family: Verdana, Arial, Helvetica, sans-serif;
  padding: 10px;
}
h2 {
  font-size: 16pt;
  color: #4B75B9;
  margin-top: 25px;
  margin-bottom: 7px;
  border-bottom: 1px solid #4B75B9;
}
p,div,table,td,tr {
  margin: 0px;
}

table {
  font-size: 10pt;
}
td.tag {
  padding: 3px;
  font-weight: bold;
  width: 100px;
  height: 30px;
  background-color: #D5E0F1;
}
td.tag_last {
  padding: 3px;
  font-weight: bold;
  height: 30px;
  background-color: #D5E0F1;
}
tr.stat {
  height: 40px;
}
td.fname {
  padding: 5px;
  background-color: #D5E0F1;
}
td.stat {
  padding: 3px;
}
td.stat p {
  padding: 1px;
  margin: 1px;
}
.stat_pass {
  background-color: #81D674;
}
.stat_fail {
  background-color: #E38692;
}
.stat_none {
  background-color: #E0E0E0;
  color: #999;
  text-align: center;
}
.stat_notags {
  background-color: #F0F0F0;
  color: #555;
  border: 1px solid #AAA;
}

.stat_notyet {
  background-color: #EBF182;
}
div.detail {
  margin: 10px;
}
div.detail div {
  margin: 3px;
  padding: 6px;
}
div.detail div h3 {
  margin: 3px;
  padding: 0px;
}
div.detail p {
  margin: 2px;
  padding: 0px;
}
.hide {
  display: none;
}
div.env p {
  margin: 3px;
}
span.btn {
  border: 2px solid #8BA7D5;
  font-weight: bold;
  padding: 2px;
  color: #8BA7D5;
  font-size: 10pt;
}
#menu div {
  position: relative;
}

.arrow_box {
  display: none;
  position: absolute;
  padding: 16px;
  -webkit-border-radius: 8px;
  -moz-border-radius: 8px;  
  border-radius: 8px;
  background: #333;
  color: #fff;
}

.arrow_box:after {
  position: absolute;
  top: -10px;
  left: 25px; 
  width: 0;
  height: 0;
  margin-left: -10px;
  border: solid transparent;
  border-color: rgba(51, 51, 51, 0);
  border-bottom-color: #333;
  border-width: 10px;
  pointer-events: none;
  content: " ";
}



</style>
<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
</head>
<body>
<h1>S&C Service for Docker Cloud: Vulnerability Report</h1>
<div id="vars" class="hide">
</div>
<h2>Results (as of <%= Time.now.strftime("%e %b %Y %H:%M:%S%p %Z") %>) </h2>
<h3><a href="./status">Go to Compliance Report</a></h3>
<table><thead><tr>
<td class="tag">Image ID</td>
<td class="tag">Container ID</td>
<td class="tag">Created</td>
<% columns.each do |col| 
    usnid = col[0]
    summary = col[1]

%>
<td class="tag">
  <span><%= usnid %></span>
  <p class="arrow_box"><%=summary %></p>
</td>
<% end %>
</tr></thead>


<% system_status.each do |image_id, image_status| 
     num_container = image_status.size
     first_row = true
%>
<tbody>
<%
     image_status.sort_by { |cs| cs['created'] }.each do |container_status| 
       docker_container_id = container_status['docker_container_id']
       created = container_status['created']
    %> 
    <tr class="stat">
    <% if first_row %>
    <td class="fname" rowspan="<%= num_container %>">
      <p><%= image_id %></p>
      <p>created : <%= image_created[image_id] %></p>
      <p>parent : <%= pedigree[image_id[0,12]] ? pedigree[image_id[0,12]] : "" %></p>
      <p>name : <%= image_names[image_id] %></p>
    </td>
    <% 
       first_row=false
    end %>
    <td class="fname">
      <span><%=docker_container_id %></span>
    </td>
    <td class="fname">
      <span><%= created %></span>
    </td>
    <% 
      cs = cells[docker_container_id]
      columns.each do |col|
        usnid = col[0]
        vul = cs[usnid]
        class_value = ""
        status = ""
        if vul[:vulnerable]
          class_value << ' stat_fail'  
          status = 'FAIL'
        else
          class_value << ' stat_pass'
          status = 'PASS'
        end
        cell_value = "<a href=#{vul[:url]}>#{status}</a>"
        allow_box_value = "#{vul[:summary]}, #{vul[:timestamp]}"
    %>
    <td class="<%= class_value %>">
    <span><%= cell_value %></span>
    <p class="arrow_box"><%=allow_box_value %></p>
    </td>
    <% end %>
  </tr>
  <% end %>
  </tbody>
<% end %>
</table>
</body>
<script>
$(function () {
  $('span').hover(function() {
    $(this).next('p').show();
  }, function(){
    $(this).next('p').hide();
  });
});
</script>
</html>
