#!/bin/bash

#
# (c) IBM Research 2015
# Vulnerability Advisor component host assignments
#

REGCRAWLER="cloudsight-regcrawler"

declare -A CONTAINER_COUNTS=(
        [$ES_CONT]=1
        [$KAFKA_CONT]=1
        [$INDEXER_CONT]=1
        [$SEARCH_CONT]=1
        [$CONFIG_PARSER_CONT]=1
        [$COMPLIANCE_INDEXER_CONT]=1
        [$COMPLIANCE_ANNOTATOR_CONT]=1
        [$VULNERABILITY_INDEXER_CONT]=1
        [$VULNERABILITY_ANNOTATOR_CONT]=1
        [$NOTIFICATION_PROCESSOR_CONT]=1
        [$PASSWORD_ANNOTATOR_CONT]=1
        [$NOTIFICATION_INDEXER_CONT]=1
        [$USNCRAWLER_CONT]=1
        [$REGCRAWLER]=1
        [$REGISTRY_UPDATE_CONT]=1
        [$REGISTRY_MONITOR_CONT]=1
        [$REGISTRY_MONITOR_SINGLERUN_CONT]=1
        [$CONSUL_CONT]=1
        [$CONFIG_AND_METRICS_CRAWLER_CONT]=1
        [$METRICS_SERVER_CONT]=1
        [$IMAGE_RESCANNER_CONT]=1
        [$MT_LOGSTASH_FORWARDER_CONT]=1

        [$INDEXER_CONT_1]=1
        [$KAFKA_CONT_1]=1
        [$INDEXER_CONT_1]=1
        [$SEARCH_CONT]=1
        [$CONFIG_PARSER_CONT_1]=1
        [$COMPLIANCE_INDEXER_CONT_1]=1
        [$COMPLIANCE_ANNOTATOR_CONT_1]=1
        [$VULNERABILITY_INDEXER_CONT_1]=1
        [$VULNERABILITY_ANNOTATOR_CONT_1]=1
        [$PASSWORD_ANNOTATOR_CONT_1]=1
        [$NOTIFICATION_INDEXER_CONT_1]=1
        [$REGCRAWLER]=1
        [$REGISTRY_UPDATE_CONT_1]=1
        [$REGISTRY_MONITOR_CONT_1]=1
        [$CONSUL_CONT_1]=1
        )

declare -A CONTAINER_HOSTS=(
        ["$ES_CONT.1"]=$ES1
        ["$KAFKA_CONT.1"]=$KAFKA1
        ["$INDEXER_CONT.1"]=$INDEXER1
        ["$SEARCH_CONT.1"]=$SEARCH1
        ["$CONFIG_PARSER_CONT.1"]=$ANNOTATOR1
        ["$COMPLIANCE_INDEXER_CONT.1"]=$INDEXER2
        ["$COMPLIANCE_ANNOTATOR_CONT.1"]=$ANNOTATOR1
        ["$VULNERABILITY_INDEXER_CONT.1"]=$INDEXER1
        ["$VULNERABILITY_ANNOTATOR_CONT.1"]=$ANNOTATOR2
        ["$NOTIFICATION_PROCESSOR_CONT.1"]=$ANNOTATOR1
        ["$PASSWORD_ANNOTATOR_CONT.1"]=$ANNOTATOR1
        ["$NOTIFICATION_INDEXER_CONT.1"]=$INDEXER1
        ["$USNCRAWLER_CONT.1"]=$ANNOTATOR1
        ["$REGCRAWLER.1"]=$REGCRAWL1
        ["$REGISTRY_UPDATE_CONT.1"]=$REGCRAWL1
        ["$REGISTRY_MONITOR_CONT.1"]=$REGCRAWL1
        ["$REGISTRY_MONITOR_SINGLERUN_CONT.1"]=$REGCRAWL2
        ["$CONSUL_CONT.1"]=$REGCRAWL1
        ["$UPTIME_SERVER_CONT.1"]=$POLICY1
        ["$IMAGE_RESCANNER_CONT.1"]=$POLICY1

        ["$ES_CONT_1.1"]=$ES1
        ["$KAFKA_CONT_1.1"]=$KAFKA1
        ["$INDEXER_CONT_1.1"]=$INDEXER1
        ["$SEARCH_CONT_1.1"]=$SEARCH1
        ["$CONFIG_PARSER_CONT_1.1"]=$ANNOTATOR1
        ["$COMPLIANCE_INDEXER_CONT_1.1"]=$INDEXER2
        ["$COMPLIANCE_ANNOTATOR_CONT_1.1"]=$ANNOTATOR1
        ["$VULNERABILITY_INDEXER_CONT_1.1"]=$INDEXER1
        ["$VULNERABILITY_ANNOTATOR_CONT_1.1"]=$ANNOTATOR2
        ["$NOTIFICATION_PROCESSOR_CONT_1.1"]=$ANNOTATOR1
        ["$PASSWORD_ANNOTATOR_CONT_1.1"]=$ANNOTATOR1
        ["$NOTIFICATION_INDEXER_CONT.1_1"]=$INDEXER1
        ["$REGCRAWLER_1.1"]=$REGCRAWL1
        ["$REGISTRY_UPDATE_CONT_1.1"]=$REGCRAWL1
        ["$REGISTRY_MONITOR_CONT_1.1"]=$REGCRAWL1
        ["$CONSUL_CONT_1.1"]=$REGCRAWL1
        )

declare -A WRITABLE_CLUSTER_NODES=(
        [$ES_CONT]=${CONTAINER_COUNTS[$ES_CONT]}
        [$KAFKA_CONT]=${CONTAINER_COUNTS[$KAFKA_CONT]}
        )

CONTAINER_STARTUP_ORDER=($MT_LOGSTASH_FORWARDER_CONT \
      $CONFIG_AND_METRICS_CRAWLER_CONT \
      $METRICS_SERVER_CONT \
      $UPTIME_SERVER_CONT \
      $CONSUL_CONT \
      $ES_CONT \
      $KAFKA_CONT \
      $INDEXER_CONT \
      $COMPLIANCE_INDEXER_CONT \
      $VULNERABILITY_INDEXER_CONT \
      $NOTIFICATION_INDEXER_CONT \
      $NOTIFICATION_PROCESSOR_CONT \
      $USNCRAWLER_CONT \
      $COMPLIANCE_ANNOTATOR_CONT \
      $VULNERABILITY_ANNOTATOR_CONT \
      $CONFIG_PARSER_CONT \
      $PASSWORD_ANNOTATOR_CONT \
      $REGCRAWLER \
      $REGISTRY_UPDATE_CONT \
      $REGISTRY_MONITOR_CONT \
      $REGISTRY_MONITOR_SINGLERUN_CONT \
      $SEARCH_CONT \
      $IMAGE_RESCANNER_CONT
      )

CONTAINER_INDIVIDUAL_STARTUP_ORDER=(
      $CONSUL_CONT_1 \
      $ES_CONT_1 \
      $KAFKA_CONT_1 \
      $INDEXER_CONT_1 \
      $COMPLIANCE_INDEXER_CONT_1 \
      $VULNERABILITY_INDEXER_CONT_1 \
      $NOTIFICATION_INDEXER_CONT_1 \
      $COMPLIANCE_ANNOTATOR_CONT_1 \
      $VULNERABILITY_ANNOTATOR_CONT_1 \
      $CONFIG_PARSER_CONT_1 \
      $PASSWORD_ANNOTATOR_CONT_1 \
      $REGCRAWLER_1 \
      $REGISTRY_UPDATE_CONT_1 \
      $REGISTRY_MONITOR_CONT_1 \
      $SEARCH_CONT_1
      )
